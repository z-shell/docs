[[ -n ${OPTS[opt_-p,--parallel]} && $1 != 1 ]] && return

emulate -LR zsh
builtin setopt nullglob extendedglob warncreateglobal typesetsilent

integer use_C=$2

typeset -a symlinked backup_comps
local c cfile bkpfile action

symlinked=( "${ZI[COMPLETIONS_DIR]}"/_[^_.]*~*.zwc )
backup_comps=( "${ZI[COMPLETIONS_DIR]}"/[^_.]*~*.zwc )
for c in "${symlinked[@]}" "${backup_comps[@]}"; do
  action=0
  cfile="${c:t}"
  cfile="_${cfile#_}"
  bkpfile="${cfile#_}"
  .zi-forget-completion "$cfile"
done

+zi-message "Initializing completion ({func}compinit{rst}){â€¦}"
command rm -f ${ZI[ZCOMPDUMP_PATH]:-${XDG_DATA_HOME:-$ZDOTDIR:-$HOME}/.zcompdump}
(( ${+functions[_vim_files]} )) && unfunction _vim_files

builtin autoload -Uz compinit
compinit ${${(M)use_C:#1}:+-C} -d ${ZI[ZCOMPDUMP_PATH]:-${XDG_DATA_HOME:-$ZDOTDIR:-$HOME}/.zcompdump} "${(Q@)${(z@)ZI[COMPINIT_OPTS]}}"
