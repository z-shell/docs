builtin setopt localoptions nullglob

typeset -a matches m
matches=( ${ZI[PLUGINS_DIR]}/*/*.zwc(DN) )

if [[ "${#matches[@]}" -eq "0" ]]; then
  builtin print "No compiled plugins"
  return 0
fi
local cur_plugin="" uspl1 file user plugin
for m in "${matches[@]}"; do
  file="${m:t}"
  uspl1="${${m:h}:t}"
  .zi-any-to-user-plugin "$uspl1"
  user="${reply[-2]}" plugin="${reply[-1]}"
  if [[ "$cur_plugin" != "$uspl1" ]]; then
    [[ -n "$cur_plugin" ]] && builtin print
    .zi-any-colorify-as-uspl2 "$user" "$plugin"
    builtin print -r -- "$REPLY:"
    cur_plugin="$uspl1"
  fi
  builtin print "$file"
done
