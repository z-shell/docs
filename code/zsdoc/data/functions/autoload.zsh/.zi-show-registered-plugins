emulate -LR zsh
setopt extendedglob warncreateglobal typesetsilent noshortloops
typeset -a filtered
local keyword="$1"
keyword="${keyword## ##}"
keyword="${keyword%% ##}"
if [[ -n "$keyword" ]]; then
  builtin print "Installed plugins matching ${ZI[col-info]}$keyword${ZI[col-rst]}:"
  filtered=( "${(M)ZI_REGISTERED_PLUGINS[@]:#*$keyword*}" )
else
  filtered=( "${ZI_REGISTERED_PLUGINS[@]}" )
fi
local i
for i in "${filtered[@]}"; do
  [[ "$i" = "_local/zi" ]] && continue
  .zi-any-colorify-as-uspl2 "$i"
  [[ "${ZI[STATES__$i]}" = "1" ]] && REPLY="$REPLY ${ZI[col-info]}*${ZI[col-rst]}"
  builtin print -r -- "$REPLY"
done
