emulate -LR zsh
builtin setopt extendedglob typesetsilent noshortloops rcquotes ${${${+reply}:#0}:+warncreateglobal}
if [[ -n $2 ]]; then
  2=${~2}
  reply=( ${1:-${${(M)2#/}:+%}} ${${${(M)1#%}:+$2}:-${2//---//}} )
  return 0
fi
if [[ $1 = /* ]]; then
  reply=( % $1 )
  return 0
fi
if [[ $1 = %* ]]; then
  local -A map
  map=( ZPFX "$ZPFX" HOME $HOME SNIPPETS $ZI[SNIPPETS_DIR] PLUGINS $ZI[PLUGINS_DIR] )
  reply=( % ${${1/(#b)(#s)%(${(~j:|:)${(@k)map}}|)/$map[$match[1]]}} )
  reply[2]=${~reply[2]}
  return 0
fi
1=${1//---//}
if [[ $1 = */* ]]; then
  reply=( ${1%%/*} ${1#*/} )
  return 0
fi
reply=( "" "${1:-_unknown}" )
return 0
