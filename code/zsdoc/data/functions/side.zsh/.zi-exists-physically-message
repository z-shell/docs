builtin emulate -LR zsh
builtin setopt extendedglob warncreateglobal typesetsilent noshortloops rcquotes
if ! .zi-exists-physically "$1" "$2"; then
  .zi-any-to-user-plugin "$1" "$2"
  if [[ $reply[1] = % ]] {
    .zi-any-to-pid "$1" "$2"
    local spec1=$REPLY
    if [[ $1 = %* ]] {
      local spec2=%${1#%}${${1#%}:+${2:+/}}$2
    } elif [[ -z $1 || -z $2 ]] {
      local spec3=%${1#%}${2#%}
    }
  } else {
    integer nospec=1
  }
  .zi-any-colorify-as-uspl2 "$1" "$2"

  +zi-message "{error}No such (plugin or snippet){rst}: $REPLY."
  [[ $nospec -eq 0 && $spec1 != $spec2 ]] && +zi-message "(expands to: {file}${spec2#%}{rst})."
  return 1
fi
return 0
